name: Benchmark

on:
    push:
        branches:
            - main
        paths:
            - "src/**"
            - "inputs/**"
            - "Cargo.toml"
            - "Cargo.lock"
            - ".github/scripts/update_benchmarks.py"
            - ".github/workflows/benchmark.yml"
    workflow_dispatch:

permissions:
    contents: write

jobs:
    benchmark:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Set up Rust
              uses: dtolnay/rust-toolchain@stable

            - name: Build
              run: cargo build --release

            - name: Run benchmarks and update README
              run: python3 .github/scripts/update_benchmarks.py

            - name: Commit changes
              uses: stefanzweifel/git-auto-commit-action@v5
              with:
                  commit_message: "docs: update benchmarks [skip ci]"
                  file_pattern: README.md
                  commit_options: "--no-verify"
